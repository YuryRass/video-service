# Video Streaming Management API

## Описание проекта

Video Streaming Management API — это мини-сервис, предназначенный для управления видеопотоками. Сервис позволяет загружать информацию о видео, генерировать HLS-плейлисты, кэшировать данные с помощью Redis и обрабатывать события асинхронно. Проект разработан с использованием Python 3.12 и асинхронного фреймворка FastAPI.

### Основные функции

1. **Загрузка информации о видео**: Эндпоинт для добавления нового видео для пользователя в систему.
2. **Получение информации о видео**: Эндпоинт для извлечения данных о видео для текущего пользователя с кэшированием в Redis.
3. **Генерация HLS-плейлиста**: Автоматическая генерация HLS-плейлистов при загрузке нового видео.
4. **Асинхронная обработка**: Фоновая обработка событий с использованием очередей.
5. **Управление пользователями**: Эндпоинты для регистрации и аутентификации пользователей.

## Схема базы данных

```plaintext
+------------------+   +------------------+
|      video       |   |      user        |
+------------------+   +------------------+
| id (PK)          |   | id (PK)          |
| title            |   | email            |
| url              |   | password         |
| user_id          |   +------------------+
+------------------+
```
`Таблица video`
- **id**: Уникальный идентификатор видео.
- **title**: Название видео.
- **url**: URL видеофайла.
- **user_id**: ID пользователя (внешний ключ), создавшего видео.

`Таблица user`
- **id**: Уникальный идентификатор пользователя.
- **email**: E-mail пользователя.
- **password**: пароль пользователя.

## Порядок запуска проекта

### Предварительные требования

- Установленный [Docker](https://www.docker.com/)
- Установленный [Docker Compose](https://docs.docker.com/compose/)
- Установленный Python 3.12 (для разработки и тестирования)

### Запуск приложения

1. Клонируйте репозиторий:

   ```bash
   git clone https://github.com/YuryRass/video-service.git
   cd video-service
   ```
2. Переименуйте файл с настройками
    ```bash
    mv .env-example .env
    ```

3. Соберите и запустите контейнеры с помощью Docker Compose:

   ```bash
   docker-compose up --build
   ```

4. После успешного запуска API будет доступен по адресу: `http://localhost:8000`.

### Использование API
- **Регистрация пользователя**:
    ```bash
    curl -X 'POST' \
    'http://0.0.0.0:8000/register' \
     -H 'accept: application/json' \
     -H 'Content-Type: application/json' \
     -d '{
      "email": "user@example.com",
      "password": "string"
     }'
    ```
- **Аутентификация пользователя**:
    ```bash
    curl -X 'POST' \
     'http://0.0.0.0:8000/login' \
     -H 'accept: application/json' \
     -H 'Content-Type: application/json' \
     -d '{
      "email": "user@example.com",
      "password": "string"
     }'
    ```
- **Добавление видео**:
    ```bash
    curl -X POST "http://localhost:8000/videos" -H "Content-Type: application/json" -d '{"title": "Football Match", "url": "http://example.com/video.mp4"}'
    ```

- **Получение информации о видео**:
    ```bash
    curl -X GET "http://localhost:8000/videos/{id}"
    ```

## Зависимости проекта

- `fastapi`: Основной фреймворк для разработки API.
- `uvicorn`: ASGI сервер для запуска приложения.
- `asyncpg`: Драйвер для работы с PostgreSQL.
- `redis`: Клиент для работы с Redis.
- `celery`: Библиотека для управления асинхронными задачами.
- `pydantic`: Для валидации данных.

## Тестирование

После запуска приложения введите команду:
```bash
docker compose exec api pytest
```